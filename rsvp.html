<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Inner Circle — RSVP</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root{
      --bg:#000; --ink:#fff; --muted:#a8a8a8; --field:#101010; --border:#2a2a2a;
      --red:#e11900; --red-hover:#b31200; --err:#ff9a9a; --ok:#b7f2c2;
    }
    html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    body{display:flex;align-items:center;justify-content:center;padding:28px}
    .wrap{width:min(640px,100%)}

    /* Header */
    h1{margin:0 0 6px;font-size:28px;font-weight:700;text-align:center}
    .lead{margin:0 0 22px;text-align:center;color:var(--muted);font-size:14px}

    /* Form */
    form{display:grid;gap:16px;background:transparent}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    label{display:block;margin:0 0 6px;font-size:13px;color:#ddd}
    input,select,textarea{
      width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--border);
      background:var(--field);color:var(--ink);font-size:14px;outline:none;
      transition:border-color .15s ease, box-shadow .15s ease;
    }
    input:focus,select:focus,textarea:focus{border-color:#494949;box-shadow:0 0 0 3px rgba(255,255,255,.06)}
    textarea{min-height:96px;resize:vertical}

    /* CTA circle */
    .circle-btn{
      display:flex;align-items:center;justify-content:center;
      width:120px;height:120px;border-radius:50%;margin:18px auto 0;
      background:var(--red);color:#fff;font-weight:800;font-size:18px;border:0;cursor:pointer;
      box-shadow:0 12px 32px rgba(0,0,0,.45);transition:background .2s ease, transform .08s ease, opacity .2s ease;
      user-select:none;
    }
    .circle-btn:hover{background:var(--red-hover)}
    .circle-btn:active{transform:scale(.965)}
    .circle-btn[disabled]{opacity:.6;cursor:not-allowed}

    /* Messages */
    .msg{min-height:20px;text-align:center;font-size:14px;margin-top:8px}
    .msg.err{color:var(--err)}
    .msg.ok{color:var(--ok)}

    /* Help text */
    .hint{font-size:12px;color:#8b8b8b;margin-top:6px}

    @media (max-width:640px){ .row2{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Inner Circle</h1>
    <p class="lead">Confirm your attendance</p>

    <form id="rsvpForm" novalidate>
      <div class="row2">
        <div>
          <label for="first">First Name</label>
          <input id="first" name="first" autocomplete="given-name" required />
        </div>
        <div>
          <label for="last">Last Name</label>
          <input id="last" name="last" autocomplete="family-name" required />
        </div>
      </div>

      <div class="row2">
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" inputmode="email" autocomplete="email" required />
        </div>
        <div>
          <label for="phone">Phone (for SMS)</label>
          <input id="phone" name="phone" type="tel" placeholder="+1 555 123 4567" autocomplete="tel" />
        </div>
      </div>

      <div class="row2">
        <div>
          <label for="notify">How should we notify you?</label>
          <select id="notify" name="notify">
            <option value="email">Email</option>
            <option value="text">Text</option>
            <option value="both">Both</option>
          </select>
        </div>
        <div>
          <label for="plusone">Plus One?</label>
          <select id="plusone" name="plusone">
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>
        </div>
      </div>

      <div>
        <label for="diet">Dietary Notes (optional)</label>
        <textarea id="diet" name="diet" placeholder="Allergies or preferences"></textarea>
      </div>

      <div>
        <label for="notes">Notes (optional)</label>
        <textarea id="notes" name="notes" placeholder="Anything else we should know?"></textarea>
      </div>

      <button class="circle-btn" id="submitBtn" type="submit">Send</button>
      <div id="msg" class="msg" role="alert" aria-live="polite"></div>

      <p class="hint" style="text-align:center;margin-top:2px;">
        This invitation is personal and non-transferable.
      </p>
    </form>
  </main>

  <script>
    /* 1) PASTE your Apps Script Web App URL (must end with /exec) */
    const RSVP_URL = "PASTE_YOUR_EXEC_URL_HERE";

    const form = document.getElementById('rsvpForm');
    const btn  = document.getElementById('submitBtn');
    const msg  = document.getElementById('msg');

    const say = (text, kind='err') => {
      msg.textContent = text || '';
      msg.className = 'msg ' + (kind || '');
      console.log('[RSVP]', text);
    };

    function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';

      if (!RSVP_URL || !RSVP_URL.includes('/exec')) {
        alert('Add your Apps Script Web App URL in rsvp.html (RSVP_URL).');
        return;
      }

      const data = Object.fromEntries(new FormData(form).entries());
      data.type = 'rsvp';

      // light client-side checks
      if (!data.first?.trim() || !data.last?.trim()) {
        say('Please enter your first and last name.'); return;
      }
      if (!validEmail(data.email || '')) {
        say('Please enter a valid email address.'); return;
      }

      // Avoid CORS preflight: send as URL-encoded (no custom headers)
      const body = new URLSearchParams(data);

      btn.disabled = true;
      say('Submitting…','ok');

      try {
        const res = await fetch(RSVP_URL, { method:'POST', body });
        const raw = await res.text();
        let json; try { json = JSON.parse(raw); } catch { json = {}; }

        if (json.ok) {
          say('Confirmed. Redirecting…','ok');
          window.location.href = 'confirm.html';
        } else {
          say('Submission error. Please try again.');
          console.log('Server response:', raw);
        }
      } catch (err) {
        console.error(err);
        say('Network error. Please try again.');
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
